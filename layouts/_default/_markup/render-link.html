{{- $link := .Destination }}
{{- $url := urls.Parse $link }}
{{- $isRemote := $url.IsAbs }}
{{- $hasSubfolder := gt (strings.Count $url.Path "/") 0 }}
{{- if and (not $isRemote) (not $hasSubfolder) (strings.HasSuffix $url.Path ".md") }}
  {{- $link = relref .Page $link }}
{{- end -}}
<a href="{{ $link | safeURL }}"{{ with .Title }} title="{{.}}"{{ end }}>{{ .Text | safeHTML }}</a>
{{- /* end */ -}}
