{{- $link := .Destination }}
{{- $url := urls.Parse $link }}
{{- $isRemote := $url.IsAbs }}
{{- $hasSubfolder := strings.Contains $url.Path "/" }}
{{- if and (not $isRemote) (not $hasSubfolder) (strings.HasSuffix $url.Path ".md") }}
  {{- $link = relref .Page $link }}
{{- end -}}
<a href="{{ $link | safeURL }}"{{ with .Title }} title="{{.}}"{{ end }}>{{ .Text | safeHTML }}</a>
{{- /* end */ -}}
